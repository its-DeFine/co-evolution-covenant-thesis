{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://github.com/its-DeFine/co-evolution-covenant-thesis/blob/main/spec/attestation.schema.json",
  "title": "Co-Evolution Covenant Attestation",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "schema_version",
    "issued_at",
    "subject",
    "bdi",
    "evaluation",
    "scores",
    "signatures"
  ],
  "properties": {
    "schema_version": {
      "type": "string",
      "description": "Schema identifier, e.g. coc-attestation-0.1"
    },
    "issued_at": {
      "type": "string",
      "format": "date-time"
    },
    "subject": {
      "type": "object",
      "additionalProperties": false,
      "required": ["subject_id"],
      "properties": {
        "subject_id": {
          "type": "string",
          "description": "A privacy-preserving identifier (e.g., a hash)."
        },
        "display_name": {
          "type": "string"
        }
      }
    },
    "bdi": {
      "type": "object",
      "additionalProperties": false,
      "required": ["bdi_id"],
      "properties": {
        "bdi_id": {
          "type": "string",
          "description": "BDI version identifier or hash."
        },
        "bdi_version": {
          "type": "string"
        }
      }
    },
    "evaluation": {
      "type": "object",
      "additionalProperties": false,
      "required": ["protocol_id", "window"],
      "properties": {
        "protocol_id": {
          "type": "string",
          "description": "Identifier for the evaluation protocol/rubric version."
        },
        "window": {
          "type": "object",
          "additionalProperties": false,
          "required": ["start_at", "end_at"],
          "properties": {
            "start_at": { "type": "string", "format": "date-time" },
            "end_at": { "type": "string", "format": "date-time" }
          }
        },
        "test_types": {
          "type": "array",
          "items": { "type": "string" },
          "description": "E.g. unassisted, retention, transfer."
        }
      }
    },
    "scores": {
      "type": "object",
      "additionalProperties": {
        "type": "object",
        "additionalProperties": false,
        "required": ["value"],
        "properties": {
          "value": { "type": "number" },
          "confidence": { "type": "number", "minimum": 0, "maximum": 1 },
          "notes": { "type": "string" }
        }
      },
      "description": "A capability vector keyed by dimension name."
    },
    "deltas": {
      "type": "object",
      "additionalProperties": {
        "type": "number"
      },
      "description": "Optional changes vs the previous attestation."
    },
    "evidence": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["type", "ref"],
        "properties": {
          "type": { "type": "string" },
          "ref": {
            "type": "string",
            "description": "A privacy-preserving reference (hash/URI) to evidence artifacts."
          },
          "description": { "type": "string" }
        }
      }
    },
    "signatures": {
      "type": "array",
      "minItems": 2,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["role", "signer_id", "signature"],
        "properties": {
          "role": {
            "type": "string",
            "enum": ["human", "partner_ai", "auditor"]
          },
          "signer_id": { "type": "string" },
          "signature": {
            "type": "string",
            "description": "Opaque signature material (implementation-defined)."
          },
          "signed_at": { "type": "string", "format": "date-time" }
        }
      }
    }
  }
}

